<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multicloud DevOps User Management</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="styles.css">
<style>
body {
    font-family: 'Segoe UI', sans-serif;
    background: url('https://images.unsplash.com/photo-1581091012184-81b5d64f0fef?auto=format&fit=crop&w=1470&q=80') no-repeat center center fixed;
    background-size: cover;
    color: #fff;
}
.container {
    background: rgba(0,0,0,0.6);
    border-radius: 12px;
    padding: 30px;
    margin-top: 30px;
}
h1, h3 { color: #f8f9fa; }
table { background: #ffffffdd; color: #000; border-radius:8px; }
th { background:#0d6efd; color:#fff; }
tr:hover { background-color: #e0f0ff; }
</style>
</head>
<body>
<div class="container">
    <div class="d-flex align-items-center mb-4">
        <img src="https://a0.awsstatic.com/libra-css/images/logos/aws_logo_smile_1200x630.png" style="height:60px" alt="AWS Logo">
        <h1 class="ms-3">Multicloud DevOps User Management</h1>
    </div>

    <div id="alertMsg"></div>

    <!-- Users Table -->
    <div class="table-responsive mb-4">
        <table class="table table-striped table-hover" id="userTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Address</th>
                    <th>Role</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <!-- Add User Button -->
    <button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#addModal">
    <i class="fa fa-plus"></i> Add User</button>

    <!-- Add User Modal -->
    <div class="modal fade" id="addModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content text-dark">
          <div class="modal-header">
            <h5 class="modal-title">Add New User</h5>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="text" id="addName" class="form-control mb-2" placeholder="Name">
            <input type="email" id="addEmail" class="form-control mb-2" placeholder="Email">
            <input type="text" id="addPhone" class="form-control mb-2" placeholder="Phone">
            <input type="text" id="addAddress" class="form-control mb-2" placeholder="Address">
            <select id="addRole" class="form-select mb-2">
                <option value="user">User</option>
                <option value="admin">Admin</option>
            </select>
            <select id="addStatus" class="form-select mb-2">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
            </select>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button class="btn btn-success" id="saveAdd">Add</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal fade" id="editModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content text-dark">
          <div class="modal-header">
            <h5 class="modal-title">Edit User</h5>
            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <input type="text" id="editName" class="form-control mb-2" placeholder="Name">
            <input type="email" id="editEmail" class="form-control mb-2" placeholder="Email">
            <input type="text" id="editPhone" class="form-control mb-2" placeholder="Phone">
            <input type="text" id="editAddress" class="form-control mb-2" placeholder="Address">
            <select id="editRole" class="form-select mb-2">
                <option value="user">User</option>
                <option value="admin">Admin</option>
            </select>
            <select id="editStatus" class="form-select mb-2">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
            </select>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button class="btn btn-primary" id="saveEdit">Save</button>
          </div>
        </div>
      </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
const backendIP = "http://44.222.212.101:5000";
let editId = null;

// Load Users
async function loadUsers() {
    const tbody = document.querySelector("#userTable tbody");
    tbody.innerHTML = "<tr><td colspan='8' class='text-center'>Loading...</td></tr>";
    try {
        const res = await fetch(`${backendIP}/users`);
        const users = await res.json();
        tbody.innerHTML = "";
        users.forEach(u=>{
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${u.id}</td>
                <td>${u.name}</td>
                <td>${u.email}</td>
                <td>${u.phone||'-'}</td>
                <td>${u.address||'-'}</td>
                <td>${u.role}</td>
                <td>${u.status}</td>
                <td>
                  <button class="btn btn-sm btn-warning me-2" onclick="openEdit(${u.id})"><i class="fa fa-edit"></i></button>
                  <button class="btn btn-sm btn-danger" onclick="deleteUser(${u.id})"><i class="fa fa-trash"></i></button>
                </td>
            `;
            tbody.appendChild(row);
        });
    } catch(err){console.error(err);}
}

// Show alert
function showAlert(msg,type="success"){
    document.getElementById("alertMsg").innerHTML = `<div class="alert alert-${type} alert-dismissible fade show">${msg}
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button></div>`;
}

// Add User
document.getElementById("saveAdd").addEventListener("click", async ()=>{
    const data={
        name:document.getElementById("addName").value,
        email:document.getElementById("addEmail").value,
        phone:document.getElementById("addPhone").value,
        address:document.getElementById("addAddress").value,
        role:document.getElementById("addRole").value,
        status:document.getElementById("addStatus").value
    };
    const res = await fetch(`${backendIP}/users/add`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(data)
    });
    const result = await res.json();
    if(res.ok){showAlert(result.message);loadUsers();new bootstrap.Modal(document.getElementById('addModal')).hide();}
    else showAlert(result.error,"danger");
});

// Open Edit Modal
async function openEdit(id){
    editId=id;
    const res = await fetch(`${backendIP}/users/${id}`);
    const u = await res.json();
    if(res.ok){
        document.getElementById("editName").value=u.name;
        document.getElementById("editEmail").value=u.email;
        document.getElementById("editPhone").value=u.phone||"";
        document.getElementById("editAddress").value=u.address||"";
        document.getElementById("editRole").value=u.role;
        document.getElementById("editStatus").value=u.status;
        new bootstrap.Modal(document.getElementById('editModal')).show();
    }
}

// Save Edit
document.getElementById("saveEdit").addEventListener("click", async ()=>{
    const data={
        name:document.getElementById("editName").value,
        email:document.getElementById("editEmail").value,
        phone:document.getElementById("editPhone").value,
        address:document.getElementById("editAddress").value,
        role:document.getElementById("editRole").value,
        status:document.getElementById("editStatus").value
    };
    const res = await fetch(`${backendIP}/users/update/${editId}`,{
        method:"PUT",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(data)
    });
    const result = await res.json();
    if(res.ok){showAlert(result.message);loadUsers();new bootstrap.Modal(document.getElementById('editModal')).hide();}
    else showAlert(result.error,"danger");
});

// Delete User
async function deleteUser(id){
    if(confirm("Are you sure to delete?")){
        const res = await fetch(`${backendIP}/users/delete/${id}`,{method:"DELETE"});
        const result = await res.json();
        if(res.ok) showAlert(result.message), loadUsers();
        else showAlert(result.error,"danger");
    }
}

loadUsers();
</script>
</body>
</html>
